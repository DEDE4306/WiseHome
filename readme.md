## 智能家居控制系统

基于 LangGraph 和 LangChain 构建的智能语音家居助手系统，支持自然语言交互，能够识别用户意图并调用相应工具执行智能家居控制任务。（目前仅仅是模拟，可以考虑接入真实控制）

---

## 系统架构

### 核心技术栈
- **LangGraph**: 构建状态流转图，管理多步骤任务执行
- **LangChain**: Agent 框架，实现工具调用和模型推理
- **MCP (Model Context Protocol)**: 工具服务器，提供智能家居控制接口
- **FunASR**: 流式语音识别，支持实时语音转文字
- **模型**: 大语言模型，提供意图识别和任务拆分能力

### 工作流程

```
用户输入 → 意图识别 → 任务拆分 → 路由分发 → Agent执行 → 返回结果
```

#### 任务类型识别
- **Simple（单一操作）**: 直接执行的单个任务
  - 示例: "打开灯"、"查询天气"
- **Mixed（多个独立任务）**: 多个可并行执行的任务
  - 示例: "打开空调并查询天气"
- **Complex（多步协同）**: 需要先查询信息再执行的任务
  - 示例: "打开所有房间的灯"（需先查询房间列表）

#### 任务类别路由
- **Chat**: 普通对话，无需工具
- **Query Info**: 信息查询，使用查询类工具
- **Smart Home Control**: 设备控制，使用控制类工具

---

## 支持功能

### 设备控制
- **开关控制**: "打开灯"、"关闭卧室空调"
- **参数控制**: "空调调到26度"、"调亮灯光"
- **音乐控制**: "播放音乐"、"停止音乐"

### 信息查询
- **时间查询**: "现在几点"
- **天气查询**: "今天的天气怎么样"
- **设备状态**: "查询空调温度"、"查询灯光亮度"
- **用户信息**: "我的房间有哪些"、"我的设备列表"

### 复合操作
- **并行任务**: "打开卧室空调并查询天气"
- **复杂操作**: "打开所有房间的灯"
- **个性化操作**: "播放我喜欢的歌"

---

## 系统组成

### 核心模块
| 模块 | 文件 | 功能描述 |
|------|------|----------|
| Workflow | `core/workflow.py` | 状态流转图定义，任务路由和执行逻辑 |
| 语音识别 | `core/speech_recognition.py` | 实时语音采集、VAD检测、ASR识别 |
| 模型配置 | `core/model.py` | 大模型初始化和配置 |
| 工具服务器 | `wisehome_control.py` | MCP工具服务器，提供设备控制接口 |

### 配置文件
| 文件 | 功能描述 |
|------|----------|
| `config/prompts.py` | 系统提示词模板 |
| `requirements.txt` | Python依赖包列表 |

---

## 环境依赖

### Python 版本
Python 3.10

### 依赖安装
```bash
pip install -r requirements.txt
```

### 环境变量配置
需要配置以下环境变量（在 `.env` 文件中）：
```
OPENAI_API_KEY=your_api_key
```

### 模型配置
默认使用百炼模型 `qwen3-4b`，可在 `core/model.py` 中修改。
语音识别模型默认使用 `paraformer-zh-streaming`，可以直接配置使用，
或者手动下载在 `model/paraformer-zh-streaming` 目录下。

---

## 启动方式

### 启用 FastMCP 服务
```bash
python wisehome_control.py
```

### 启用主流程
```bash
python main.py
```

---

## 项目结构
```
WiseHome/
├── core/
│   ├── workflow.py           # 状态流转图
│   ├── speech_recognition.py # 语音识别模块
│   └── model.py              # 模型配置
├── config/
│   └── prompts.py            # 提示词模板
├── db/                       # 数据库目录
│   └── ...
├── models/                   # 数据模型目录
│   └── ...
├── model/                    # 语音识别模型目录
│   └── ...
├── main.py                   # 语音交互入口
├── wisehome_control.py       # 文本交互入口
└── requirements.txt          # 依赖列表
```
